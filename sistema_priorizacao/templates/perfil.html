{% extends "homepage.html" %}

!--{% block titulo %} Perfil - {{usuario}} {% endblock %}
{% block fundo %} {% endblock %}

{% block header %}

<!-- Left links -->

<a class="text-reset me-3 align-items-center" href="{{url_for('perfil', id_usuario=usuario.id)}}">
    <i class="fas fa-house"></i>
</a>

</div>


<form class="d-flex input-group w-auto">
    <input
            type="search"
            class="form-control rounded"
            placeholder="Buscar"
            aria-label="Buscar"
            aria-describedby="search-addon"
    />
    <span class="input-group-text border-0" id="search-addon">
        <i class="fas fa-search"></i>
      </span>
</form>
<!-- Collapsible wrapper -->
<!-- Right elements -->
<div class="d-flex align-items-center">
    <!-- Icon -->

    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
            <a class="nav-link" href="{{url_for('atribuirpesos')}}" >Atribuir Pesos</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">Projetos</a>
        </li>
    </ul>


<!-- Notifications -->
<div class="dropdown">
    <a
            data-mdb-dropdown-init
            class="text-reset me-3 dropdown-toggle hidden-arrow"
            href="#"
            id="navbarDropdownMenuLink"
            role="button"
            aria-expanded="false"
    >
        <i class="fas fa-bell"></i>
        <span class="badge rounded-pill badge-notification bg-danger">1</span>
    </a>
    <ul
            class="dropdown-menu dropdown-menu-end"
            aria-labelledby="navbarDropdownMenuLink"
    >
        <li>
            <a class="dropdown-item" href="#">Some news</a>
        </li>
        <li>
            <a class="dropdown-item" href="#">Another news</a>
        </li>
        <li>
            <a class="dropdown-item" href="#">Something else here</a>
        </li>
    </ul>
</div>

    <!-- Avatar -->
    <div class="dropdown">
        <a
                data-mdb-dropdown-init
                class="dropdown-toggle d-flex align-items-center hidden-arrow"
                href="#"
                id="navbarDropdownMenuAvatar"
                role="button"
                aria-expanded="false"
        >
            <img
                    src="https://mdbcdn.b-cdn.net/img/new/avatars/2.webp"
                    class="rounded-circle"
                    height="25"
                    alt="Black and White Portrait of a Man"
                    loading="lazy"
            />
        </a>
        <ul
                class="dropdown-menu dropdown-menu-end"
                aria-labelledby="navbarDropdownMenuAvatar"
        >
            <li>
                <a class="dropdown-item" href="#">{{ usuario.username }}</a>
            </li>
            <li>
                <a class="dropdown-item" href="#">Configurações</a>
            </li>
            <li>
                <a class="dropdown-item" href="{{url_for('logout')}}">Logout</a>
            </li>
        </ul>

    </div>

</div>


{% endblock %}


{% block body %}

<nav data-mdb-navbar-init class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page"><a href="{{ url_for('atribuirpesos')}}">Projetos</a></li>
            </ol>
        </nav>
    </div>
</nav>

<body xmlns="http://www.w3.org/1999/html">
<!--    <h2> Perfil: {{ usuario.username }} </h2>-->

<br/>

{% with msgs = get_flashed_messages(category_filter=["sucesso"]) %} {% if msgs %}
<center>
    {% for msg in msgs %}
    <div class="alert alert-success" role="alert">
        {{ msg }}
    </div>
    {% endfor %}
    <p id="alerta"></p>
</center>
{% endif %} {% endwith %}

{% with msgs = get_flashed_messages(category_filter=["error"]) %} {% if msgs %}
<center>
    {% for msg in msgs %}
    <div class="alert alert-danger" role="alert">
        {{ msg }}
    </div>
    {% endfor %}
    <p id="alerta2"></p>
</center>
{% endif %} {% endwith %}

<div class="panel bg-primary text-light">
    <div class="row">
        <div class="col">
            <div class="p-3 text-center"><h1 class="display-4"> Projetos </h1></div>
        </div>
    </div>
</div>


<div class="card card-default w-100 mt-5 m-2">
    <div class="card-body">

        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#listaProjetos" role="tab" data-toggle="tab">Lista de Projetos</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" aria-current="page" href="#listaCriterios" role="tab" data-toggle="tab">Lista de
                    Critérios</a>
            </li>
        </ul>

        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="listaProjetos">
                </br>
                <table border="1" class="table table-striped table-bordered">

                    <thead class="thead-dark">
                    <tr>
                        <th scope="col" class="text-center">Nome</th>
                        <th scope="col" class="text-center">Escopo</th>
                        <th scope="col" class="text-center">Gerente</th>
                        <th scope="col" class="text-center">Ação</th>
                    </tr>
                    </thead>

                    {% for projeto in usuario.projetos %}

                    <tr>
                        <td class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"> {{ projeto.nome }}</td>
                        <td class="col-xs-4 col-sm-4 col-md-4 text-center"> {{ projeto.escopo }}</td>
                        <td class="col-xs-2 col-sm-2 col-md-2 col-lg-2 text-center"> {{ projeto.gerente }}</td>
                        <td class="col-xs-6 col-md-6 col-md-6 col-lg-6 text-center">
                            <!--                <a class="btn btn-primary"  href="{{url_for('editar', id_projeto=projeto.id)}}">-->
                            <!--                     Editar-->
                            <!--                 </a>-->
                            <a class="btn btn-primary" data-toggle="modal" data-target="#modalProjeto{{ projeto.id }}">
                                <i class="bi bi-pencil-square"></i>
                            </a>

                            <a class="btn btn-danger" onclick="excluir()" href="/excluir/{{ projeto.id }}">
                                <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                                <i class="bi bi-trash"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}

                    {% for projeto in usuario.projetos %}
                    <div class="modal fade" id="modalProjeto{{ projeto.id }}" tabindex="-1"
                         aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5">Editar de Projeto</h1>
                                    <button type="button" class="btn-close" data-dismiss="modal"
                                            aria-label="Fechar"></button>
                                </div>
                                <div class="modal-body">
                                    {% if form_editar_projeto %}
                                    <form action="/editar/{{ projeto.id }}" method="POST">
                                        {{ form_editar_projeto.csrf_token }}
                                        {{ form_editar_projeto.nome_projeto.label(class="label") }}
                                        {{ form_editar_projeto.nome_projeto(class="input", value = projeto.nome) }}
                                        <div class="modal-footer">
                                            {{ form_editar_projeto.botao_editar(class="btn btn-primary") }}
                                        </div>
                                    </form>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}

                    {% if msg %}
                    <div class="alert alert-success" role="alert">
                        {{ msg }}
                    </div>
                    {% endif %}

                </table>
                <center>
                    <button type="button" class="btn btn-primary btn-block" data-toggle="modal"
                            data-target="#exampleModal">
                        Cadastrar Projeto
                    </button>
                </center>

                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                     aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="exampleModalLabel">Cadastro de Projeto</h1>
                                <button type="button" class="btn-close" data-dismiss="modal"
                                        aria-label="Fechar"></button>
                            </div>
                            <div class="modal-body">
                                {% if form %}
                                <form method="post">
                                    {{ form.csrf_token }}
                                    {{ form.nome_projeto.label(class="label") }}
                                    {{ form.nome_projeto(class="input") }}
                                    {{ form.escopo_projeto.label(class="label") }}
                                    {{ form.escopo_projeto(class="area") }}
                                    {{ form.gerente_projeto.label(class="label") }}
                                    {{ form.gerente_projeto(class="input") }}
                                    <div class="modal-footer">
                                        {{ form.botao_confirmacao(class="botao-login") }}
                                    </div>
                                </form>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!--    <h3> Lista de Critérios </h3>-->

            <div role="tabpanel" class="tab-pane" id="listaCriterios">
                </br>
                <table border="1" class="table table-striped table-bordered">

                    <thead class="table">
                    <tr>
                        <th class="text-center" scope="col">Nome</th>
                        <th class="text-center" scope="col">Detalhamento</th>
                        <th class="text-center" scope="col">Ação</th>
                    </tr>
                    </thead>

                    {% for criterio in criterios %}
                    <tr>
                        <td class="col-xs-4 col-sm-4 col-md-6 col-lg-6 text-center"> {{ criterio.nome }}</td>
                        <td class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"> {{ criterio.detalhamento }}</td>
                        <td class="col-xs-4 col-sm-4 col-md-4 col-lg-4">

                            <a class="btn btn-primary" data-toggle="modal"
                               data-target="#modalEditarCriterio{{ criterio.id  }}">
                                <i class="bi bi-pencil-square"></i>
                            </a>
                            <a class="btn btn-danger" onclick="excluir()" href="/excluir_criterio/{{ criterio.id }}">
                                <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                                <i class="bi bi-trash"></i>
                            </a>
                        </td>
                    </tr>
                    {% if msg %}
                    <div class="alert alert-success" role="alert">
                        {{ msg }}
                    </div>
                    {% endif %}
                    {% endfor %}
                </table>


                {% for criterio in criterios %}
                <div class="modal fade" id="modalEditarCriterio{{ criterio.id }}" tabindex="-1"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5"> Editar Critério</h1>
                                <button type="button" class="btn-close" data-dismiss="modal"
                                        aria-label="Fechar"></button>
                            </div>
                            <div class="modal-body">
                                {% if form_criterio %}
                                <form method="post">
                                    {{ form_criterio.csrf_token }}
                                    {{ form_criterio.id_criterio(class="input", type="hidden", value= criterio.id) }}
                                    {{ form_criterio.nome_criterio.label(class="label") }}
                                    {{ form_criterio.nome_criterio(class="input", value = criterio.nome) }}
                                    <div class="modal-footer">
                                        {{ form_criterio.botao_editar(class="btn btn-primary") }}
                                    </div>
                                </form>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}

                <button type="button" class="btn btn-primary btn-block" data-toggle="modal"
                        data-target="#modalCriterio">
                    Cadastrar Critério
                </button>

                <div class="modal fade" id="modalCriterio" tabindex="-1" aria-labelledby="exampleModalLabel"
                     aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5"> Cadastro de Critério</h1>
                                <button type="button" class="btn-close" data-dismiss="modal"
                                        aria-label="Fechar"></button>
                            </div>
                            <div class="modal-body">
                                {% if form_criterio %}
                                <form method="post">
                                    {{ form_criterio.csrf_token }}
                                    {{ form_criterio.nome_criterio.label(class="label") }}
                                    {{ form_criterio.nome_criterio(class="input") }}
                                    {{ form_criterio.descricao_criterio.label(class="label") }}
                                    {{ form_criterio.descricao_criterio(class="area") }}
                                    <div class="modal-footer">
                                        {{ form_criterio.botao_confirmacao(class="botao-login") }}
                                    </div>
                                </form>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
</body>
{% endblock %}